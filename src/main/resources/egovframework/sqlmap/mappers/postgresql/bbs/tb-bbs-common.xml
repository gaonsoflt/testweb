<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.bbs.service.impl.CommonBBSMapper">
	<select id="readBBSList" parameterType="map" resultType="map">
		SELECT *
			FROM (
				SELECT (ROW_NUMBER() OVER()) AS RNUM, A.*
				FROM (
					SELECT
					 	seq,
						title,
						content,
						reg_dt,
						reg_usr,
						mod_dt,
						mod_usr
					FROM tb_bbs_${table_name}
					<where>
		       		<if test="CONDITION eq 'TITLE'">
		       			AND title LIKE '%'||#{KEYWORD}||'%'
		       		</if>
		       		</where>
				ORDER BY seq DESC
			) A
		) A
		WHERE 1 = 1
		<if test='PAGE != null'>
		<![CDATA[
			AND A.RNUM > (#{PAGE} - 1) * #{PAGESIZE}
			AND A.RNUM <= #{PAGE} * #{PAGESIZE}
    	]]>
		</if>
	</select>
	
	<select id="readBBSDetail" parameterType="map" resultType="map">
		SELECT
			seq,
			title,
			content,
			reg_dt,
			reg_usr,
			mod_dt,
			mod_usr
		FROM tb_bbs_${table_name}
		WHERE seq = cast(#{seq} as integer)
	</select>
	
	<select id="readBBSListCount" parameterType="map" resultType="integer">
		SELECT count(*)
		FROM tb_bbs_${table_name}
	</select>
	
	<insert id="insertBBS">
		<selectKey keyProperty="seq" resultType="integer" order="BEFORE">
			<![CDATA[
			select max(seq)+1 FROM tb_bbs_${table_name}
			]]>
		</selectKey>
		INSERT INTO tb_bbs_${table_name} (
			seq,
			title,
			content,
			reg_dt,
			reg_usr,
			mod_dt,
			mod_usr
		) VALUES (
			#{seq}, 
			#{title}, 
			#{content}, 
			now(), 
			#{reg_usr}, 
			now(), 
			#{mod_usr} 
		)
	</insert>
	
	<update id="updateBBS">
		UPDATE tb_bbs_${table_name}
		SET 
			title = #{title},
			content = #{content},
			mod_dt = now(), 
			mod_usr = #{mod_usr}, 
		WHERE seq = cast(#{seq} as integer)
	</update>
	
	<delete id="deleteBBS">
		DELETE FROM tb_bbs_${table_name} 
		WHERE 1 = 1
		AND seq = CAST(#{seq} as integer) 
	</delete>
</mapper>
