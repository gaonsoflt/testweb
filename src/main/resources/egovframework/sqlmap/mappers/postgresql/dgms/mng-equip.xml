<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="egovframework.dgms.service.impl.MngEquipMapper">


	
    
    <select id="selectMngEquipInfo" parameterType="hashMap" resultType="hashMap">

	    SELECT *
	      FROM (SELECT ROWNUM RNUM, A.*
	              FROM (SELECT EQUIPMENT_SEQ
						      ,EQUIPMENT_ID
						      ,EQUIP_TYPE
						      ,CASE
						         WHEN EQUIP_STATE = '101069' AND
						              (SELECT COUNT(1)
						                 FROM TB_RENT_MNG
						                WHERE EQUIPMENT_SEQ = TB_EQUIPMENT_INFO.EQUIPMENT_SEQ
						                  AND RENT_STATE = '101074') = 0 THEN
						          '대여가능'
						         ELSE
						          '대여중'
						       END AS RENT_YN	--기기상태 정상 AND 대여중이 아닌것.
						      ,MODEL_NM
						      ,SERIAL_NO
						      ,EQUIP_STATE
						      ,EQUIPMENT_NM
						      ,PURCHASE_DT
						      ,AREA_ID
						      ,CRE_USR
						      ,CRE_DT
						      ,MOD_USR
						      ,MOD_DT
						  FROM TB_EQUIPMENT_INFO
	                     WHERE 1=1
	                     <if test='AREA_ID != null and AREA_ID != ""'>
	                       AND REPLACE(AREA_ID, 000000, '') LIKE REPLACE(#{AREA_ID}, 000000, '') || '%'
	                     </if>  
	                     <if test='EQUIP_TYPE != null and EQUIP_TYPE != ""'>
	                       AND EQUIP_TYPE = #{EQUIP_TYPE}
	                     </if>
	                     <if test='MODEL_NM != null and MODEL_NM != ""'>
	                       AND MODEL_NM = #{MODEL_NM}
	                     </if>
	                     <if test='EQUIP_STATE != null and EQUIP_STATE != ""'>
	                       AND EQUIP_STATE = #{EQUIP_STATE}
	                     </if>
	                     <if test='PURCHASE_DT != null and PURCHASE_DT != ""'>
	                       AND PURCHASE_DT = #{PURCHASE_DT}
	                     </if>  
	                     ORDER BY EQUIPMENT_ID
	                     ) A
	           ) A
	     WHERE 1 = 1
		<if test='PAGE != null'>
		<![CDATA[
	       AND A.RNUM > (#{PAGE} - 1) * #{PAGESIZE}
	       AND A.RNUM <= #{PAGE} * #{PAGESIZE}
    	]]>
		</if>

    </select>
    
    
    <select id="selectMngEquipInfoTot" parameterType="hashMap" resultType="int">

	    SELECT COUNT(*)
	      FROM TB_EQUIPMENT_INFO
	     WHERE 1 = 1
        <if test='AREA_ID != null'>
          AND REPLACE(AREA_ID, 000000, '') LIKE REPLACE(#{AREA_ID}, 000000, '') || '%'
        </if>  
        <if test='EQUIP_TYPE != null'>
          AND EQUIP_TYPE = #{EQUIP_TYPE}
        </if>
        <if test='MODEL_NM != null'>
          AND MODEL_NM = #{MODEL_NM}
        </if>
        <if test='EQUIP_STATE != null'>
          AND EQUIP_STATE = #{EQUIP_STATE}
        </if>
        <if test='PURCHASE_DT != null'>
          AND PURCHASE_DT = #{PURCHASE_DT}
        </if>  
    </select>
    
    
    
    <insert id="insertMngEquipInfo" >
	    INSERT INTO TB_EQUIPMENT_INFO
	      (
			   EQUIPMENT_SEQ
		      ,EQUIPMENT_ID
		      ,EQUIP_TYPE
		      ,MODEL_NM
		      ,SERIAL_NO
		      ,EQUIP_STATE
		      ,EQUIPMENT_NM
		      ,PURCHASE_DT
		      ,AREA_ID
		      ,CRE_USR
		      ,CRE_DT
		      ,MOD_USR
		      ,MOD_DT
	      )
	    VALUES
	      (
	      	#{EQUIPMENT_SEQ      ,  jdbcType=VARCHAR},
			#{EQUIPMENT_ID       ,  jdbcType=VARCHAR},
			#{EQUIP_TYPE       ,  jdbcType=VARCHAR},
			#{MODEL_NM     ,  jdbcType=VARCHAR},
			#{SERIAL_NO       ,  jdbcType=VARCHAR},
			#{EQUIP_STATE     ,  jdbcType=VARCHAR},
			#{EQUIPMENT_NM           ,  jdbcType=VARCHAR},
			#{PURCHASE_DT      ,  jdbcType=VARCHAR},
			#{AREA_ID     ,  jdbcType=VARCHAR},
			#{CRE_USR       ,  jdbcType=VARCHAR},
			SYSDATE                             ,
			#{MOD_USR       ,  jdbcType=VARCHAR},
			SYSDATE
	       ) 
		
	</insert>

	<update id="updateMngEquipInfo" >
	
    UPDATE TB_EQUIPMENT_INFO
       SET 
			EQUIPMENT_ID     = #{EQUIPMENT_ID       ,  jdbcType=VARCHAR},
			EQUIP_TYPE     = #{EQUIP_TYPE       ,  jdbcType=VARCHAR},
			MODEL_NM   = #{MODEL_NM     ,  jdbcType=VARCHAR},
			SERIAL_NO     = #{SERIAL_NO       ,  jdbcType=VARCHAR},
			EQUIP_STATE   = #{EQUIP_STATE     ,  jdbcType=VARCHAR},
			EQUIPMENT_NM         = #{EQUIPMENT_NM           ,  jdbcType=VARCHAR},
			PURCHASE_DT    = #{PURCHASE_DT      ,  jdbcType=VARCHAR},
			AREA_ID   = #{AREA_ID     ,  jdbcType=VARCHAR},
			MOD_USR     = #{MOD_USR       ,  jdbcType=VARCHAR},
			MOD_DT      = SYSDATE
     WHERE EQUIPMENT_SEQ = #{EQUIPMENT_SEQ}
	</update>
	
	
    <update id="deleteMngEquipInfo" >
	    DELETE FROM TB_EQUIPMENT_INFO
		 WHERE EQUIPMENT_SEQ = #{EQUIPMENT_SEQ}
    </update>
	    

    
<!--     <select id="selectCdNmCombo" parameterType="hashMap" resultType="hashMap">
	<![CDATA[
		SELECT CATGR,
		       CD,
		       LPAD(' ', 2 * (LEVEL - 1), '>') || CD_NM  AS CD_NM_PATH,
		       CD_NM,
		       SORT_NO,
		       DEUser(USE_YN,'0','false','true')  USE_YN  , 
		       LEVEL
		  FROM TB_User_MASTER
		 WHERE LEVEL <= 2
		 START WITH CATGR = 0
		CONNECT BY CATGR = PRIOR CD
	]]>
    </select>
    
    <select id="selectMngEquipInfoCombo" parameterType="hashMap" resultType="hashMap">
    	<![CDATA[
	    SELECT * 
        FROM TB_User_MASTER 
       ORDER BY SORT_NO
    	]]>
    </select> -->
    
    
    
</mapper>
