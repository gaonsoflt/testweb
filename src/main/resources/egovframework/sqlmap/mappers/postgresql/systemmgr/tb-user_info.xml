<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="egovframework.espa.service.impl.SystemMgrUserMapper"> 
    <select id="selectSystemMgrUserInfo" parameterType="hashMap" resultType="hashMap">
	    SELECT *
	      FROM (SELECT (ROW_NUMBER() OVER()) AS RNUM, A.*
	              FROM (SELECT 
							USER_SEQ    ,
							USER_NAME     ,
							PHONE   ,
							NOTE		,
							USER_ID     ,
							'' AS PASSWORD   ,
							BIRTHDAY    ,
							USER_TYPE   ,
							CASE WHEN USE_YN = '1' THEN true ELSE false end USE_YN,
							CRE_USR     ,
							CRE_DT      ,
							MOD_USR     ,
							MOD_DT      ,
							NOTE
	                      FROM TB_USER_INFO 
	                     WHERE 1=1
				       		<if test="G_UserNmVal != null">
				         		AND USER_NAME LIKE '%'||#{G_UserNmVal}||'%' 
				       		</if>
	                     ORDER BY USER_NAME
	                     ) A
	           ) A
	     WHERE 1 = 1
		<if test='PAGE != null'>
		<![CDATA[
	       AND A.RNUM > (#{PAGE} - 1) * #{PAGESIZE}
	       AND A.RNUM <= #{PAGE} * #{PAGESIZE}
    	]]>
		</if>
    </select>
    
    
    <select id="selectSystemMgrUserInfoTot" parameterType="hashMap" resultType="int">
	    SELECT COUNT(*)
		FROM tb_user_info
    </select>
    
    
    <insert id="insertSystemMngUserInfo" >
	    INSERT INTO TB_USER_INFO
	      (
	      	USER_SEQ			, 
			USER_ID				, 
			USER_NAME			, 
			PHONE				, 
			PASSWORD			, 
			BIRTHDAY			, 
			USER_TYPE			, 
			USE_YN				, 
			CRE_USR				, 
			CRE_DT				, 
			MOD_USR				, 
			MOD_DT				,
			NOTE
	      )
	    VALUES
	      (
	      	#{USER_SEQ      ,  jdbcType=VARCHAR},
			#{USER_ID       ,  jdbcType=VARCHAR},
			#{USER_NM       ,  jdbcType=VARCHAR},
			#{MOBILE_NO     ,  jdbcType=VARCHAR},
			#{LOGIN_PWD     ,  jdbcType=VARCHAR},
			#{BIRTHDAY      ,  jdbcType=VARCHAR},
			#{USER_TYPE     ,  jdbcType=VARCHAR},
			#{USE_YN        ,  jdbcType=VARCHAR},
			#{CRE_USR       ,  jdbcType=VARCHAR},
			SYSDATE                             ,
			#{MOD_USR       ,  jdbcType=VARCHAR},
			SYSDATE			,
			#{NOTE		    ,  jdbcType=VARCHAR}
	       ) 
		
	</insert> 

	<update id="updateSystemMngUserInfo" >
    UPDATE TB_USER_INFO
       SET 
			USER_NM     = #{USER_NM       ,  jdbcType=VARCHAR},
			PHONE   = #{MOBILE_NO     ,  jdbcType=VARCHAR},
			<!-- USER_ID     = #{USER_ID       ,  jdbcType=VARCHAR},-->
			BIRTHDAY    = #{BIRTHDAY      ,  jdbcType=VARCHAR},
			USER_TYPE   = #{USER_TYPE     ,  jdbcType=VARCHAR},
			USE_YN      = #{USE_YN        ,  jdbcType=VARCHAR},
			MOD_USR     = #{MOD_USR       ,  jdbcType=VARCHAR},
			MOD_DT      = SYSDATE		  ,
			NOTE		= #{NOTE		  ,  jdbcType=VARCHAR}
     WHERE USER_SEQ = #{USER_SEQ}
	</update>
	
	<update id="updateMngPassInfo" >
    UPDATE TB_USER_INFO
       SET 
			PASSWORD   = #{LOGIN_PWD     ,  jdbcType=VARCHAR}
     WHERE USER_SEQ = #{USER_SEQ}
	</update>
	
    <update id="deleteSystemMngUserInfo" >
	    DELETE FROM TB_USER_INFO
		 WHERE USER_SEQ = #{USER_SEQ}
    </update> 
    
</mapper>
